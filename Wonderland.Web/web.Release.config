<?xml version="1.0" encoding="utf-8"?>

<!-- For more information on using web.config transformation visit http://go.microsoft.com/fwlink/?LinkId=125889 -->

<configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform">

	<!-- Email -->
	<system.net>
		<mailSettings xdt:Transform="Replace">
			<smtp deliveryMethod="Network">
				<network 
					defaultCredentials="false"
					enableSsl="true" 
					port="587" 
					host="email-smtp.eu-west-1.amazonaws.com" 
					userName="paperemail" 
					password="{bV{dYzyckH2" />
			</smtp>  
		</mailSettings>
	</system.net>
	
	<!-- Distrubuted Calls Package, syncs EC2 nodes -->
	<extendedDistributedCalling xdt:Transform="SetAttributes(enabled)" enabled="true" />

	<appSettings>
		<add xdt:Transform="SetAttributes" xdt:Locator="Match(key)" key="DotMailer:Enabled" value="true" />
		<!-- SagePay Live -->
    <add xdt:Transform="SetAttributes" xdt:Locator="Match(key)" key="SagePay:Vendor" value="macmillancance3" />
		<!--
    <add xdt:Transform="SetAttributes" xdt:Locator="Match(key)" key="SagePay:TransactionRegistrationUrl" value="https://live.sagepay.com/gateway/service/vspserver-register.vsp" />
		-->
		<add xdt:Transform="SetAttributes" xdt:Locator="Match(key)" key="SagePay:NotificationUrl" value="https://www.welcometowonderland.org.uk/Umbraco/Api/SagePayApi/Notifcation/" />
		<add xdt:Transform="SetAttributes" xdt:Locator="Match(key)" key="SagePay:RedirectDomain" value="https://www.welcometowonderland.org.uk" />
		<!-- AgeBase Distrubuted Calls (keeps web servers insync) -->
		<add xdt:Transform="Insert" key="AWS_ACCESS_KEY_ID" value="AKIAJGFQT56XNLQBAQSA"/>
		<add xdt:Transform="Insert" key="AWS_SECRET_KEY" value="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" />
		<add xdt:Transform="Insert" key="AWS_ENV_NAME" value="wonderland" />
		<add xdt:Transform="Insert" key="AWS_REGION" value="eu-west-1" />
		<!-- Please also see /config/FileSystemProviders.config, as this contains references to AWS -->
	</appSettings>
   
	<connectionStrings>
		<add name="umbracoDbDSN" connectionString="Data Source=wonderlanddb.cvhckjyoscdl.eu-west-1.rds.amazonaws.com,1433;Initial Catalog=wonderland-4;Persist Security Info=True;User ID=paperdb;Password=w0nder!and"
    xdt:Transform="SetAttributes" xdt:Locator="Match(name)"/>
	</connectionStrings>

	<!-- Enable DistributedCalling, used to allow AWS instances to communicate -->
	<extendedDistributedCalling xdt:Locator="SetAttributes" enabled="true" />

	<system.webServer>
		<!-- Force all traffic onto HTTPS -->
		<rewrite xdt:Transform="Insert">
			<rules>
				<rule name="Force HTTPS" stopProcessing="true">
					<match url="healthcheck.html" negate="true" />
					 <conditions>
							 <add input="{HTTP_X_FORWARDED_PROTO}" pattern="https" negate="true" />
					 </conditions>
					 <action type="Redirect" url="https://{HTTP_HOST}" redirectType="Permanent" />
				</rule>
			</rules>
		</rewrite>
	</system.webServer>

</configuration>